 # Brute Force Interceptor

## Описание

Brute Force Interceptor — это микросервис, предназначенный для предотвращения брутфорс-атак при авторизации в различных системах. Сервис работает на уровне server-server, то есть скрыт от конечного пользователя.

## Функциональность

Сервис ограничивает частоту попыток авторизации для различных комбинаций параметров, таких как логин, пароль и IP-адрес. Для этого используется алгоритм sliding window. Выбирается окно и настраивается "скольжение", в рамках которого осуществляется подсчет. Время окна - 1 минута. Время жизни бакета, который хранит запрос - 10 минут. Сервис также поддерживает white/black листы для IP-адресов и подсетей.

## Архитектура

Микросервис состоит из API, базы данных для хранения настроек и black/white списков. Сервис предоставляет GRPC.

## Методы API

### Попытка авторизации

**Запрос:**
- `login`
- `password` (required)
- `ip` (required)


  ***Пример:***
```json
{ 
  "login":  "ivanov",
  "password":  "123456",
  "ip": "192.168.10.15"
}
```

**Ответ:**
- `ok` (true/false) — сервис возвращает `ok=true`, если считает, что запрос нормальный, и `ok=false`, если считает, что происходит брутфорс.

***Пример:***
```json
{ "ok":  true }
```

### Сброс bucket

**Запрос:**
- `login`
- `ip`

### Добавление IP в blacklist

**Запрос:**
- `subnet` (IP + маска)

### Удаление IP из blacklist

**Запрос:**
- `subnet` (IP + маска)

### Добавление IP в whitelist

**Запрос:**
- `subnet` (IP + маска)

### Удаление IP из whitelist

**Запрос:**
- `subnet` (IP + маска)

## Конфигурация

Основные параметры конфигурации:
- `limit.login` — лимит попыток в минуту для данного логина.
- `limit.password` — лимит попыток в минуту для данного пароля.
- `limit.ipaddress` — лимит попыток в минуту для данного IP.

## Command-Line интерфейс

Для ручного администрирования сервиса разработан CLI. 
Через CLI можно вызвать сброс бакета и управлять whitelist/blacklist-ом.

## Развертывание

Развертывание микросервиса осуществляется командой `make run` в корневой директории проекта.

## Установка и запуск

1. **Клонируйте репозиторий:**
   ```sh
   git clone https://github.com/Tel3scop/brute-force-interceptor
   cd brute-force-interceptor
   ```

2. **Соберите и запустите сервис:**
   ```sh
   make run
   ```

## Использование CLI

1. **Сброс bucket:**
   ```sh
   ./cli reset-bucket --login your_login --ip your_ip
   ```

2. **Добавление IP в blacklist:**
   ```sh
   ./cli add-blacklist --subnet 192.1.1.0/25
   ```

3. **Удаление IP из blacklist:**
   ```sh
   ./cli remove-blacklist --subnet 192.1.1.0/25
   ```

4. **Добавление IP в whitelist:**
   ```sh
   ./cli add-whitelist --subnet 192.1.1.0/25
   ```

5. **Удаление IP из whitelist:**
   ```sh
   ./cli remove-whitelist --subnet 192.1.1.0/25
   ```

## Тестирование

1. **Unit-тесты:**
   ```sh
   make test
   ```

2. **Интеграционные тесты:**
   ```sh
   make integration-test
   ```
